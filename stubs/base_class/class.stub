<?php

namespace Tests\Feature\{{ group }};

use Illuminate\Testing\TestResponse;
use Dkdev\Testrine\BaseTestrineCase;
use Illuminate\Support\Facades\Notification;
use Illuminate\Support\Facades\Queue;
use Dkdev\Testrine\Contracts\DocIgnoreContract;
use Dkdev\Testrine\Contracts\JobContract;
use Dkdev\Testrine\Contracts\NotificationContract;
use Dkdev\Testrine\Contracts\InvalidateContract;
use Dkdev\Testrine\Contracts\InvalidParametersContract;
use Dkdev\Testrine\Parser\TestParser;
use Dkdev\Testrine\Support\Infrastructure\Config;
use Dkdev\Testrine\Hooks\AssertHook;
use Dkdev\Testrine\Hooks\CodeHook;
use Dkdev\Testrine\Hooks\InvalidateHook;
use Dkdev\Testrine\Hooks\InvalidDataCodeHook;
use Dkdev\Testrine\Hooks\InvalidParametersCodeHook;
use Dkdev\Testrine\Hooks\InvalidParametersHook;
use Dkdev\Testrine\Hooks\JobHook;
use Dkdev\Testrine\Hooks\MockHook;
use Dkdev\Testrine\Hooks\NotifyHook;
use Dkdev\Testrine\Hooks\ParametersHook;
use Dkdev\Testrine\Hooks\ResponseHook;
use Dkdev\Testrine\Hooks\SeedHook;
use Dkdev\Testrine\Hooks\ValidateHook;

abstract class {{ class_name }} extends BaseTestrineCase
{
    public function getGroupName(): string
    {
        return '{{ group }}';
    }

    private function callRouteAction(array $data = [], array $parameters = []): TestResponse
    {
        $route = $this->getRouteByName();
        $method = $route->methods()[0];
        $uri = route(name: $this->getRouteName(), parameters: $parameters);

        if ($this->implements(contract: JobContract::class)) {
           Queue::fake();
        }

        if ($this->implements(contract: NotificationContract::class)) {
           Notification::fake();
        }

        $this->executeHook(hook: SeedHook::class);
        $this->executeHook(hook: MockHook::class);

        $testResponse = $this->json(method: $method, uri: $uri, data: $data);

        if (Config::getGroupValue(group: $this->getGroupName(), key: 'document') && ! $this->implements(contract: DocIgnoreContract::class)) {
            TestParser::make()->makeAutoDoc(response: $testResponse);
        }

        return $testResponse;
    }

    {{ route_actions }}

    {{ test_from_auth_users }}

    public function testMiddleware(): void
    {
        $this->assertRouteHasExactMiddleware(
            names: $this->getMiddleware()
        );
    }

    {{ send_not_valid_data }}

    {{ send_invalid_parameters }}
}
